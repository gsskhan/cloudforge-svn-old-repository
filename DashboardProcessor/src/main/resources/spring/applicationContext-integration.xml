<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:int-jms="http://www.springframework.org/schema/integration/jms"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-3.0.xsd
		http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.2.xsd
		http://www.springframework.org/schema/integration/jms http://www.springframework.org/schema/integration/jms/spring-integration-jms-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd">

<bean id="messageListenerContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
	<property name="connectionFactory" ref="cachingConnectionFactory" />
	<property name="destination" ref="destination" />
    <property name="maxConcurrentConsumers" value="1"/>
    <property name="concurrentConsumers" value="1"/>
    <property name="receiveTimeout" value="5000"/>
    <property name="recoveryInterval" value="60000"/>
    <property name="autoStartup" value="true"/>
    <property name="errorHandler" ref="jmsErrorHandlerUtil" /> 
    <property name="transactionManager" ref="jmsTransManager" />
</bean>

<bean id="jmsErrorHandlerUtil" class="com.citi.risk.dashboard.util.JmsErrorHandlerUtil" />

<int:channel id="inbound" />
<int-jms:message-driven-channel-adapter  id="jmsIn" channel="inbound" container="messageListenerContainer" acknowledge="transacted" extract-payload="false"/>

<bean  id="messageConsumerService" class="com.citi.risk.dashboard.service.MessageConsumerService" />
<int:service-activator input-channel="inbound" output-channel="outbound" ref="messageConsumerService" method="processMessage" />

<int:channel id="outbound" >
	<int:interceptors>
		<int:wire-tap channel="messageAuditLoggingChanel"/>
	</int:interceptors>
</int:channel>
<bean id="messageAuditLoggingService" class="com.citi.risk.dashboard.service.MessageAuditLoggingService"></bean>
<int:service-activator input-channel="messageAuditLoggingChanel" ref="messageAuditLoggingService" method="addXmlMessageToDatabase" />


<bean id="messageProcessingService" class="com.citi.risk.dashboard.service.MessageProcessingService" />
<int:service-activator input-channel="outbound" ref="messageProcessingService" method="parseAndProcessMessage" />

<task:scheduled-tasks>
	<task:scheduled ref="noDataManager" method="addNotApplicableRecords" fixed-delay="${nodata.task.fixed.delay}" initial-delay="${nodata.task.initial.delay}"/>
</task:scheduled-tasks>

</beans>
