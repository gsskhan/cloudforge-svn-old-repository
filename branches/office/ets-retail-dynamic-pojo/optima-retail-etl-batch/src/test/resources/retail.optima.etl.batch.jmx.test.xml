<?xml version="1.0" encoding="UTF-8"?>

<beans	xmlns="http://www.springframework.org/schema/beans"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:p="http://www.springframework.org/schema/p"
		xmlns:util="http://www.springframework.org/schema/util"
		xmlns:context="http://www.springframework.org/schema/context"
		xsi:schemaLocation="
			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
			http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd
			http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd">
    
    <context:property-placeholder
            location="classpath:optima.retail.etl.batch.jmx.props"
            ignore-resource-not-found="true"
            ignore-unresolvable="true"
            system-properties-mode="OVERRIDE"
    />
    
    <!-- server-side connector -->
    <bean   id="batchJmxServerConnector"
            class="org.springframework.jmx.support.ConnectorServerFactoryBean"
            p:objectName="connector:name=${module}-rmi"
            p:serviceUrl="service:jmx:rmi://${jmx.host}/jndi/rmi://${jmx.host}:${jmx.port}/${module}"
    />
    
    <!-- mbean exporter -->        
    <bean   id="batchMBeanExporter"
            class="org.springframework.jmx.export.MBeanExporter"
            p:beans-ref="batchExportingBeanMap"
            p:server-ref="mbeanServer"
            p:assembler-ref="batchMBeanInfoAssembler"
            p:registrationBehaviorName="REGISTRATION_FAIL_ON_EXISTING"
    />
    
    <bean   id="batchMBeanInfoAssembler"
            class="org.springframework.jmx.export.assembler.InterfaceBasedMBeanInfoAssembler"
            p:managedInterfaces-ref="batchManagedInterfaces"
    />
    
    <!-- exporting beans -->
    <util:map id="batchExportingBeanMap">
        <entry key="optima.retail.etl:module=${module}" value-ref="batchMBean"/>
    </util:map>
        
    <!-- managed interface -->
    <util:list id="batchManagedInterfaces">
        <value>com.citi.retail.optima.etl.batch.container.jmx.BatchMBean</value>
    </util:list>
    
    <bean	id="batchMBean"
    		class="com.citi.retail.optima.etl.batch.container.jmx.impl.BatchMBeanImpl"
    		p:batchJmsAdapter-ref="batchJmsAdapter"
    />
    
    <bean   id="batchJmsAdapter" class="org.mockito.Mockito" factory-method="mock"> 
            <constructor-arg value="org.springframework.integration.jms.JmsMessageDrivenEndpoint" />
    </bean>     
</beans>